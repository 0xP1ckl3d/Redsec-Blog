<!-- The Top Bar -->

<header id="topbar-wrapper" class="flex-shrink-0" aria-label="Top Bar">
  <div id="topbar" class="d-flex align-items-center justify-content-between px-lg-3 h-100 w-100">

    <!-- Left side: breadcrumb and title -->
    <div class="d-flex align-items-center flex-grow-1">
      <nav id="breadcrumb" aria-label="Breadcrumb" class="me-3">
        {% assign paths = page.url | split: '/' %}
        {% if paths.size == 0 or page.layout == 'home' %}
          <span>{{ site.data.locales[include.lang].tabs.home | capitalize }}</span>
        {% else %}
          {% for item in paths %}
            {% if forloop.first %}
              <span>
                <a href="{{ '/' | relative_url }}">
                  {{- site.data.locales[include.lang].tabs.home | capitalize -}}
                </a>
              </span>
            {% elsif forloop.last %}
              {% if page.collection == 'tabs' %}
                <span>{{ site.data.locales[include.lang].tabs[item] | default: page.title }}</span>
              {% else %}
                <span>{{ page.title }}</span>
              {% endif %}
            {% elsif page.layout == 'category' or page.layout == 'tag' %}
              <span>
                <a href="{{ item | append: '/' | relative_url }}">
                  {{- site.data.locales[include.lang].tabs[item] | default: page.title -}}
                </a>
              </span>
            {% endif %}
          {% endfor %}
        {% endif %}
      </nav>

      <div id="topbar-title">
        {% if page.layout == 'home' %}
          {{- site.data.locales[include.lang].title | default: site.title -}}
        {% elsif page.collection == 'tabs' or page.layout == 'page' %}
          {%- capture tab_key -%}{{ page.url | split: '/' }}{%- endcapture -%}
          {{- site.data.locales[include.lang].tabs[tab_key] | default: page.title -}}
        {% else %}
          {{- site.data.locales[include.lang].layout[page.layout] | default: page.layout | capitalize -}}
        {% endif %}
      </div>
    </div>

    <!-- Right side: search, theme toggle, TOC toggle -->
    <div class="d-flex align-items-center gap-2 ms-auto">

      <!-- Search -->
      <button type="button" id="search-trigger" class="btn btn-link" aria-label="Search" title="Search">
        <i class="fas fa-search fa-fw"></i>
      </button>

      <!-- Dark mode toggle -->
      <button id="mode-toggle" class="btn btn-link" aria-label="Toggle dark mode" title="Toggle dark mode">
        <i class="fas fa-adjust fa-fw"></i>
      </button>

      <!-- TOC toggle -->
      <button id="toc-toggle" class="btn btn-link" aria-label="Toggle sidebar" title="Toggle sidebar">
        <i class="fas fa-list fa-fw"></i>
      </button>
    </div>
  </div>
</header>

<!-- TOC toggle functionality -->
<script>
  document.addEventListener("DOMContentLoaded", () => {
    const tocToggle = document.getElementById("toc-toggle");
    const toc = document.querySelector(".toc-wrapper");

    if (tocToggle) {
      if (!toc) {
        tocToggle.style.display = "none";
      } else {
        tocToggle.addEventListener("click", () => {
          toc.classList.toggle("d-none");
        });
      }
    }
  });
</script>
